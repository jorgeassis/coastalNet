# Modelling coastal oceanographic connectivity

## Biophysical Modeling Framework

We developed a biophysical modeling framework to simulate how ocean currents can facilitate or hinder the connectivity of marine species along global coastlines. 

This framework is not new; it has been successfully applied in previous studies to track the genetic flow among various ecological groups, such as macroalgae and mangroves, by simulating the journey of passive, virtual particles across the ocean's surface. These particles are meant to mimic the dispersal of species, carried by the ocean currents.

>> Using biophysical modeling and empirical genetic data, we show that oceanographic connectivity can explain population genetic differentiation in mangroves, regardless of the species, region, and genetic marker, overcoming classical approaches based on geographic distance. 

Our simulations draw on the high-resolution global ocean model provided by the Copernicus Marine Environment Monitoring Service (CMEMS). This model gives us daily updates on ocean currents at an approximately 8 km resolution, enabling us to predict potential pathways for species dispersal across the marine ecosystem accurately.

The global distribution of marine biodiversity was mapped using species distribution models. These models estimate where species are likely to be found, based on current knowledge, including data from resources like AlgaeBase. Although some species-specific data were missing, the broad coverage of our models ensures a comprehensive representation of marine biodiversity.

From strategically chosen locations along the coast, we released virtual particles into the ocean model to simulate dispersal events over an 11-year span. Each particle's journey, lasting up to 180 days, was meticulously tracked to understand how species might travel from one location to another, contributing to biodiversity connectivity.

## Graph theory for connectivity analysis

To analyze the vast amounts of data generated by our simulations, we turned to graph theory, a branch of mathematics that helps in understanding the relationships and connectivity within networks. By constructing a matrix that captures the likelihood of particles—and by extension, species—moving from one location to another, we were able to quantify the connectivity across the marine ecosystem. This matrix is based on the concept of "backward-in-time" dispersal probabilities, which aligns with how genetic material spreads through populations over time.

Our analysis utilized two approaches to construct connectivity matrices: one that accounts for variable dispersal capabilities of different species and another based on a fixed average dispersal time. These matrices help us understand the effects of different dispersal strategies on biodiversity connectivity.

Using graph theory, we then mapped out the network of connections between locations, applying algorithms to find the most efficient paths that particles could take across the network. This not only revealed direct connections but also highlighted key stepping-stone locations that play critical roles in facilitating long-distance dispersal. To further delve into the intricacies of this connectivity network, we employed centrality metrics to identify which locations are most vital for maintaining biodiversity connectivity across the ocean.




We generated simulations of oceanographic connectivity with a biophysical modelling framework widely implemented elsewhere and validated against genetic data of different ecological groups (e.g., macroalgae in Buonomo et al., 2017, Assis et al., 2018, 2022 and mangroves in Gouvêa et al., 2023). This framework tracks passive Lagrangian particles by integrating daily gridded velocity fields provided by the Copernicus Marine Environment Monitoring Service (CMEMS, https://doi.org/10.48670/moi-00021), a data-assimilative operational ocean model implemented on the global ocean at 1/12° horizontal resolution (approximately 8 km). Connectivity simulations were conducted over the global marine distribution (Figure 1), as inferred by stacked species distribution model (SDM) provided by Fragkopoulou et al., 2022. These models provided distribution estimates for nearly all the species of our dataset except for Fucus guiryi, Ishige okamurae, Nereia lophocladia, and Pylaiella littoralis. As the observed distributions of these four species (according to AlgaeBase, Guiry & Guiry, 2023) overlapped with our computed global marine forest distribution, we consider the latter as a comprehensive representation of our compiled species.
The biophysical model released individual particles daily from the centre of sites (hereafter referred to as source and sink sites) with 8.45 km hexagons edge, implemented along the coastline over the global marine forest distribution (n = 16489 source/sink sites, Figure 1). The particles were released over the 11-year period (2010-2020) and advected upon the ocean surface (top vertical layer of the CMEMS model) for up to 180 days until they eventually ended up on sink sites or got lost in the open ocean. The position of each particle was calculated hourly with a bilinear interpolation following the Courant–Friedrichs–Lewy condition. We assign for each sink site, the number of particles incoming for source sink, and the associated mean trajectory time in hours.

## Multigeneration connectivity and centrality using graph theory

We produced a unique matrix of pairwise probability of connectivity by dividing the weighted number of particles received in sink site from source site by the total weighted number of particles received in sink site, applying the “backward-in-time” dispersal probability approach in Legrand et al. (2022). This approach emphasizes the immigration process, which is instinctively more consistent with genetic theory (i.e., at time t, newly arriving genes at t - 1 are more important than exported genes at t + 1). We obtained a square 16489 x 16489 matrix, summarising the probability of connectivity among different sink and source sites across the global marine forest distribution and considering the weighting function that integrates their diverse dispersal capacities. To evaluate the impact of such functions, we also generate an additional square matrix using a fixed dispersal time of 7.43 d (i.e., the mean of dispersal range time for in-house dispersal capacity). This matrix only considered trajectories with a dispersal duration equal to or less than this fixed time, without any weighting process, as commonly implemented elsewhere (e.g., Gouvêa et al., 2023, Legrand et al., 2019, 2022).
We used graph theory to compute asymmetrical multigeneration connectivity between all sampling localities (i.e., the closest source and sink sites) described in all studies comprised by our genetic differentiation dataset. We set a graph of 16489 nodes representing the sites, while the edges are indexed by the probabilities of connectivity. We use the Dijkstra algorithm to find the shortest path between sampling sites by minimising the sum of distance-transformed probabilities (i.e., -log(probabilities); Dijkstra, 1959). We later determined multi-generation connectivity by multiplying edge probabilities along the inferred shortest paths. We counted the number of stepping-stones needed to connect sampling sites (i.e., A -> B is 0 step, and A -> X -> B is 1 step).  To match the symmetric feature of genetic differentiation, we transformed the anisotropic multigeneration probability between pairs of sampling sites to a symmetric probability with P = PAB + PBA - PABPBA (Legrand et al., 2022). Note that we computed the average pairwise genetic differentiation levels when two or more sampled populations were found within a site (Gouvêa et al., 2023). In addition, we utilised a centrality graph-based index to assess the potential role of centrality in population connectivity (Assis et al., 2021; Gouvêa et al., 2023). We considered the harmonic centrality metric, which calculates, for each node, the inverse of the total length of the shortest paths between that node and all other nodes (Marchiori & Latora, 2000). This metric is similar to the closeness centrality (Gouvêa et al., 2023), but it accommodates non-connected graphs, which is applicable to our case.
